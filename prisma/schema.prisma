generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

////////////////////////////////////////////////////
// ENUMS
////////////////////////////////////////////////////

enum UserRole {
  MEMBER   // Üye (site kullanıcısı)
  EDITOR   // İçerik editörü
  ADMIN    // Admin panel yetkisi
  SUPERADMIN
}

enum VolunteerStatus {
  PENDING
  APPROVED
  REJECTED
}

enum DonationStatus {
  PENDING
  COMPLETED
  FAILED
  REFUNDED
}

////////////////////////////////////////////////////
// MODELLER
////////////////////////////////////////////////////

model User {
  id           String   @id @default(cuid())
  email        String   @unique
  passwordHash String
  role         UserRole @default(MEMBER)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([role])
}

// Haber ve Blog İçerikleri
model Post {
  id        String   @id @default(cuid())
  title     String
  content   String   @db.Text
  image     String?
  slug      String   @unique
  published Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([published])
  @@index([createdAt])
}

// Bağış Seçenekleri (Su Kuyusu, Yetim, Gıda vb.)
model DonationCategory {
  id            String   @id @default(cuid())
  name          String
  description   String   @db.Text
  image         String?  // Görsel URL
  fixedPrice    Float?   // Sabit fiyatlı bağışlar için
  targetAmount  Float?   // Hedeflenen miktar
  collected     Float    @default(0)
  isActive      Boolean  @default(true)
  order         Int      @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  donations Donation[]

  @@index([isActive])
}

// Site ayarları (iletişim, gönüllü form, iyzico vb.)
model Setting {
  id    String @id  // örn: contact_info, volunteer_form, iyzico
  value String @db.Text  // JSON string
}

// Donasyon işlem kayıtları (audit trail + iyzico eşleştirme)
model Donation {
  id                   String         @id @default(cuid())
  categoryId           String
  category             DonationCategory @relation(fields: [categoryId], references: [id])
  amount               Float
  currency             String         @default("TRY")
  status               DonationStatus @default(PENDING)
  conversationId       String?        // iyzico conversation id
  paymentId            String?        // iyzico payment id
  donorName            String?
  donorEmail           String?
  donorPhone           String?
  donorIdentityNumber  String?
  ip                   String?
  createdAt            DateTime       @default(now())

  @@index([categoryId])
  @@index([status])
  @@index([conversationId])
}

// Gönüllü Başvuruları
model VolunteerApplication {
  id        String          @id @default(cuid())
  fullName  String          // Liste için (data'dan veya eski kayıtlardan)
  email     String          // Liste için
  phone     String          // Liste için
  reason    String          @db.Text  // Liste için
  data      Json?           // Dinamik form alanlarının tamamı
  status    VolunteerStatus @default(PENDING)
  createdAt DateTime        @default(now())
  updatedAt DateTime        @updatedAt

  @@index([status])
  @@index([createdAt])
}

// Banka Hesap Bilgileri
model BankAccount {
  id       String  @id @default(cuid())
  bankName String
  branch   String
  iban     String  @unique
  currency String  @default("TRY")
  order    Int     @default(0)
  isActive Boolean @default(true)

  @@index([isActive])
}
