generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

////////////////////////////////////////////////////
// ENUMS
////////////////////////////////////////////////////

enum UserRole {
  EDITOR
  ADMIN
  SUPERADMIN
}

enum VolunteerStatus {
  PENDING
  APPROVED
  REJECTED
}

enum DonationStatus {
  PENDING
  COMPLETED
  FAILED
  REFUNDED
}

////////////////////////////////////////////////////
// MODELLER
////////////////////////////////////////////////////

model Unit {
  id        String   @id @default(cuid())
  name      String
  slug      String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  slides    Slide[]
  users     UserProfile[]
}

model Slide {
  id         String   @id @default(cuid())
  title      String
  desc       String
  imageUrl   String
  thumbUrl   String?
  ctaText    String
  ctaHref    String
  order      Int      @default(0)
  isActive   Boolean  @default(true)

  // ✅ ARŞİV
  isArchived Boolean  @default(false)
  archivedAt DateTime?

  // ✅ birime bağlı olmalı (yetki için şart)
  unitId     String
  unit       Unit     @relation(fields: [unitId], references: [id])

  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([unitId])
  @@index([isActive, isArchived, order])
}

model UserProfile {
  // supabase auth user id (uuid string)
  id        String   @id
  email     String?  @unique
  role      UserRole @default(EDITOR)

  unitId    String
  unit      Unit     @relation(fields: [unitId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([unitId])
  @@index([role])
}

// Haber ve Blog İçerikleri
model Post {
  id        String   @id @default(cuid())
  title     String
  content   String   @db.Text
  image     String?
  slug      String   @unique
  published Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([published])
  @@index([createdAt])
}

// Bağış Seçenekleri (Su Kuyusu, Yetim, Gıda vb.)
model DonationCategory {
  id            String   @id @default(cuid())
  name          String
  description   String   @db.Text
  fixedPrice    Float?   // Sabit fiyatlı bağışlar için
  targetAmount  Float?   // Hedeflenen miktar
  collected     Float    @default(0)
  isActive      Boolean  @default(true)
  order         Int      @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  donations Donation[]

  @@index([isActive])
}

// Donasyon işlem kayıtları (audit trail + iyzico eşleştirme)
model Donation {
  id                   String         @id @default(cuid())
  categoryId           String
  category             DonationCategory @relation(fields: [categoryId], references: [id])
  amount               Float
  currency             String         @default("TRY")
  status               DonationStatus @default(PENDING)
  conversationId       String?        // iyzico conversation id
  paymentId            String?        // iyzico payment id
  donorName            String?
  donorEmail           String?
  donorPhone           String?
  donorIdentityNumber  String?
  ip                   String?
  createdAt            DateTime       @default(now())

  @@index([categoryId])
  @@index([status])
  @@index([conversationId])
}

// Gönüllü Başvuruları
model VolunteerApplication {
  id        String          @id @default(cuid())
  fullName  String
  email     String
  phone     String
  reason    String          @db.Text
  status    VolunteerStatus @default(PENDING)
  createdAt DateTime        @default(now())
  updatedAt DateTime        @updatedAt

  @@index([status])
  @@index([createdAt])
}

// Banka Hesap Bilgileri
model BankAccount {
  id       String  @id @default(cuid())
  bankName String
  branch   String
  iban     String  @unique
  currency String  @default("TRY")
  order    Int     @default(0)
  isActive Boolean @default(true)

  @@index([isActive])
}
